# Docker Compose Environment Variables
# Devstral + OpenHands Configuration

# CUDA Configuration
CUDA_DOCKER_ARCH=61             # Pascal=61, Turing=75, Ampere=86, Ada=89, Hopper=90
CUDA_VERSION=12.6.0
UBUNTU_VERSION=24.04

# llama.cpp Server Configuration
# Network Settings
LLAMA_ARG_HOST=0.0.0.0          # Server bind address (0.0.0.0 = all interfaces)
LLAMA_ARG_PORT=11434            # Server port (11434 = Ollama standard)

# Model Configuration
LLAMA_ARG_MODEL=/models/devstral-q4_k_m.gguf    # Path to model file inside container

# Context and Memory Settings
LLAMA_ARG_CTX_SIZE=131072       # Context window size (128k tokens for full Devstral support)
LLAMA_ARG_N_GPU_LAYERS=35       # Number of model layers to run on GPU (-1 = all layers)

# Performance Settings
LLAMA_ARG_THREADS=6             # CPU threads for processing (match your CPU cores)
LLAMA_ARG_BATCH_SIZE=2048       # Batch size for prompt processing (higher = faster but more VRAM)
LLAMA_ARG_UBATCH_SIZE=512       # Micro-batch size for generation (lower = less VRAM)

# Advanced Features
LLAMA_ARG_FLASH_ATTN=1          # Enable flash attention (1=on, 0=off) - faster processing
LLAMA_ARG_CONT_BATCHING=1       # Enable continuous batching (1=on, 0=off) - better throughput
LLAMA_ARG_PARALLEL=2            # Number of parallel processing slots (2 = dual concurrent streams)

# OpenHands Configuration
OPENHANDS_VERSION=0.48
OPENHANDS_RUNTIME_VERSION=0.48-nikolaik
OPENHANDS_PORT=3000
OPENHANDS_LLM_MODEL=devstral
OPENHANDS_LLM_BASE_URL=http://llama-cpp-server:11434
OPENHANDS_WORKSPACE_BASE=/workspace
OPENHANDS_LOG_ALL_EVENTS=true

# Model Configuration
MODEL_NAME=devstral-q4_k_m.gguf
MODEL_URL=https://huggingface.co/mistralai/Devstral-Small-2507_gguf/resolve/main/Devstral-Small-2507-Q4_K_M.gguf
MODEL_DIR=~/.models                  # User-specific model storage directory

# GPU Configuration (for Pascal architecture)
NVIDIA_VISIBLE_DEVICES=all
NVIDIA_DRIVER_CAPABILITIES=compute,utility

# Resource Limits
MEMORY_LIMIT=16g
SHARED_MEMORY_SIZE=2g

# Health Check Configuration
HEALTHCHECK_START_PERIOD=60s     # Start health checks after 1 minute
HEALTHCHECK_INTERVAL=30s         # Health check frequency
HEALTHCHECK_TIMEOUT=10s          # Health check timeout
HEALTHCHECK_RETRIES=10           # Higher retries since we're always "healthy" during download
